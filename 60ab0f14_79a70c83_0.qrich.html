<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html>
<head>
<meta name="qrichtext" content="1" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<style type="text/css">
p, li { white-space: pre-wrap; }
</style>
</head>
<body style="font-family:'微软雅黑'; font-size:11pt; font-weight:400; font-style:normal;">
<p style="margin:0px;">什么是指令重排</p>
<p style="margin:0px;"><span style=" font-weight:600;">你写出来的程序，计算机并不会按照你写的那样去执行</span></p>
<p style="margin:0px;">源代码 --&gt; 编译器优化的重排 --&gt; 指令并行也可能会重排 --&gt; 内存系统也会重排 --&gt; 执行</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;">如下例子：</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">int</span><span style="font-family:'Courier';"> x = </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">1</span><span style="font-family:'Courier';">;		</span><span style="font-family:'Courier'; font-style:italic; color:#778899;">//1</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">int</span><span style="font-family:'Courier';"> y = </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">2</span><span style="font-family:'Courier';">; 	</span><span style="font-family:'Courier'; font-style:italic; color:#778899;">//2</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">x = x + </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">5</span><span style="font-family:'Courier';">;		</span><span style="font-family:'Courier'; font-style:italic; color:#778899;">//3</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">y = x * x;		</span><span style="font-family:'Courier'; font-style:italic; color:#778899;">//4</span></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;">我们期望的执行顺序：1234		实际执行的可能是：2134	1324</p>
<p style="margin:0px;">而不可能是4321</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;"><span style=" font-weight:600;">处理器在进行指令重排的时候，会考虑到数据之间的依赖性</span></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;">使用 volatile 可以禁止指令重排</p>
<p style="margin:0px;">实现原理：CPU的指令中的一个内容叫做内存屏障</p>
<p style="margin:0px;">内存屏障的作用是：</p>
<p style="margin:0px;">	1，保证特定操作的执行顺序</p>
<p style="margin:0px;">	2，可以保证某些变量的内存可见性</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>

<script type="text/javascript" language="javascript" src="jquery.js"></script>
<script type="text/javascript" language="javascript" src="itemlink.js"></script></body>
</html>