<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html>
<head>
<meta name="qrichtext" content="1" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<style type="text/css">
p, li { white-space: pre-wrap; }
</style>
</head>
<body style="font-family:'微软雅黑'; font-size:11pt; font-weight:400; font-style:normal;">
<p style="margin:0px;">拉取镜像</p>
<p style="margin:0px;">docker pull gitlab/gitlab-ce:latest</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;">在宿主机递归创建目录，即使上级目录不存在，会按目录层级自动创建目录</p>
<p style="margin:0px;">mkdir -p /usr/local/gitlab/config</p>
<p style="margin:0px;">mkdir -p /usr/local/gitlab/logs</p>
<p style="margin:0px;">mkdir -p /usr/local/gitlab/data</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;">创建并编辑 gitlab_start.sh 文件</p>
<p style="margin:0px;">touch gitlab_start.sh</p>
<p style="margin:0px;">vim gitlab_start.sh</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;">将以下内容复制进去</p>
<p style="margin:0px;">#!/bin/sh</p>
<p style="margin:0px;">GITLAB_HOME=/usr/local/gitlab</p>
<p style="margin:0px;">sudo docker run -dp 443:443 -p 8088:80 -p 10080:22 -h localhost \</p>
<p style="margin:0px;">    --name gitlab \</p>
<p style="margin:0px;">    --restart always \</p>
<p style="margin:0px;">    --volume $GITLAB_HOME/config:/etc/gitlab \</p>
<p style="margin:0px;">    --volume $GITLAB_HOME/logs:/var/log/gitlab \</p>
<p style="margin:0px;">    --volume $GITLAB_HOME/data:/var/opt/gitlab \</p>
<p style="margin:0px;">    gitlab/gitlab-ce:latest</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;">在该文件目录下,授予gitlab_start.sh执行权限</p>
<p style="margin:0px;">chmod +x gitlab_start.sh</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;">执行脚本</p>
<p style="margin:0px;">./gitlab_start.sh</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;">修改gitlab配置文件</p>
<p style="margin:0px;">vi /usr/local/gitlab/config/gitlab.rb</p>
<p style="margin:0px;">gitlab_rails['gitlab_shell_ssh_port'] = 10080</p>
<p style="margin:0px;">external_url 'http://localhost'</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;">应用配置，重启服务</p>
<p style="margin:0px;"># 进入gitlab bash</p>
<p style="margin:0px;">docker exec -it gitlab bash    </p>
<p style="margin:0px;"># 重新应用gitlab的配置</p>
<p style="margin:0px;">gitlab-ctl reconfigure</p>
<p style="margin:0px;"># 重启gitlab服务</p>
<p style="margin:0px;">gitlab-ctl restart</p>
<p style="margin:0px;"># 查看gitlab运行状态</p>
<p style="margin:0px;">gitlab-ctl status</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;">GitLab默认密码</p>
<p style="margin:0px;">初次安装Gitlab时，密码放在了一个临时文件中了</p>
<p style="margin:0px;">在container里面</p>
<p style="margin:0px;">/etc/gitlab/initial_root_password</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="margin:0px;">这个文件将在首次执行reconfigure后24小时自动删除</p>
<p style="margin:0px;">进去之后需要修改密码</p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>
<p style="-qt-paragraph-type:empty; margin:0px;"><br /></p>

<script type="text/javascript" language="javascript" src="jquery.js"></script>
<script type="text/javascript" language="javascript" src="itemlink.js"></script></body>
</html>