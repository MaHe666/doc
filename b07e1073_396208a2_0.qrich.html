<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html>
<head>
<meta name="qrichtext" content="1" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<style type="text/css">
p, li { white-space: pre-wrap; }
</style>
</head>
<body style="font-family:'微软雅黑'; font-size:11pt; font-weight:400; font-style:normal;">
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">import</span><span style="font-family:'Courier';"> axios from </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'axios'</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">import</span><span style="font-family:'Courier';"> { Notification, MessageBox, Message, Loading } from </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'element-ui'</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">import</span><span style="font-family:'Courier';"> store from </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'@/store'</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">import</span><span style="font-family:'Courier';"> { getToken } from </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'@/utils/auth'</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">import</span><span style="font-family:'Courier';"> errorCode from </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'@/utils/errorCode'</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">import</span><span style="font-family:'Courier';"> { tansParams, blobValidate } from </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">&quot;@/utils/ruoyi&quot;</span><span style="font-family:'Courier';">;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">import</span><span style="font-family:'Courier';"> cache from </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'@/plugins/cache'</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">import</span><span style="font-family:'Courier';"> { saveAs } from </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'file-saver'</span></p>
<p style="-qt-paragraph-type:empty; margin:0px; font-family:'Courier';"><br /></p>
<p style="margin:0px;"><span style="font-family:'Courier';">let downloadLoadingInstance;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 是否显示重新登录</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">export</span><span style="font-family:'Courier';"> let isRelogin = { show: false };</span></p>
<p style="-qt-paragraph-type:empty; margin:0px; font-family:'Courier';"><br /></p>
<p style="margin:0px;"><span style="font-family:'Courier';">axios</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">defaults</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">headers[</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'Content-Type'</span><span style="font-family:'Courier';">] = </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'application/json;charset=utf-8'</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 创建axios实例</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> service = axios</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">create({</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// axios中请求配置有baseURL选项，表示请求URL公共部分</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  baseURL: process</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">env</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">VUE_APP_BASE_API,</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 超时</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  timeout: </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">10000</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">})</span></p>
<p style="-qt-paragraph-type:empty; margin:0px; font-family:'Courier';"><br /></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-style:italic; color:#778899;">// request拦截器</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">service</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">interceptors</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">request</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">use(config =&gt; {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 是否需要设置 token</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> isToken = (config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">headers || {}).isToken === false</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 是否需要防止数据重复提交</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> isRepeatSubmit = (config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">headers || {}).repeatSubmit === false</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (getToken() &amp;&amp; !isToken) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">headers[</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'Authorization'</span><span style="font-family:'Courier';">] = </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'Bearer '</span><span style="font-family:'Courier';"> + getToken() </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 让每个请求携带自定义token 请根据实际情况自行修改</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// get请求映射params参数</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">method === </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'get'</span><span style="font-family:'Courier';"> &amp;&amp; config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">params) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    let url = config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">url + </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'?'</span><span style="font-family:'Courier';"> + tansParams(config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">params);</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    url = url</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">slice(</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">0</span><span style="font-family:'Courier';">, -</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">1</span><span style="font-family:'Courier';">);</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">params = {};</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">url = url;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (!isRepeatSubmit &amp;&amp; (config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">method === </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'post'</span><span style="font-family:'Courier';"> || config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">method === </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'put'</span><span style="font-family:'Courier';">)) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> requestObj = {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      url: config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">url,</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      data: </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">typeof</span><span style="font-family:'Courier';"> config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">data === </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'object'</span><span style="font-family:'Courier';"> ? JSON</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">stringify(config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">data) : config</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">data,</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      time: </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">new</span><span style="font-family:'Courier';"> </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">Date</span><span style="font-family:'Courier';">().getTime()</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> sessionObj = cache</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">session</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">getJSON(</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'sessionObj'</span><span style="font-family:'Courier';">)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (sessionObj === </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">undefined</span><span style="font-family:'Courier';"> || sessionObj === </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">null</span><span style="font-family:'Courier';"> || sessionObj === </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">''</span><span style="font-family:'Courier';">) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      cache</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">session</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">setJSON(</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'sessionObj'</span><span style="font-family:'Courier';">, requestObj)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    } </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">else</span><span style="font-family:'Courier';"> {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> s_url = sessionObj</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">url;                  </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 请求地址</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> s_data = sessionObj</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">data;                </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 请求数据</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> s_time = sessionObj</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">time;                </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 请求时间</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> interval = </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">1000</span><span style="font-family:'Courier';">;                         </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 间隔时间(ms)，小于此时间视为重复提交</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (s_data === requestObj</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">data &amp;&amp; requestObj</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">time - s_time &lt; interval &amp;&amp; s_url === requestObj</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">url) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> message = </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'数据正在处理，请勿重复提交'</span><span style="font-family:'Courier';">;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        console</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">warn(`[${s_url}]: ` + message)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">return</span><span style="font-family:'Courier';"> Promise</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">reject(</span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">new</span><span style="font-family:'Courier';"> Error(message))</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      } </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">else</span><span style="font-family:'Courier';"> {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        cache</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">session</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">setJSON(</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'sessionObj'</span><span style="font-family:'Courier';">, requestObj)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">return</span><span style="font-family:'Courier';"> config</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">}, error =&gt; {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    console</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">log(error)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    Promise</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">reject(error)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">})</span></p>
<p style="-qt-paragraph-type:empty; margin:0px; font-family:'Courier';"><br /></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 响应拦截器</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">service</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">interceptors</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">response</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">use(res =&gt; {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 未设置状态码则默认成功状态</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> code = res</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">data</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">code || </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">200</span><span style="font-family:'Courier';">;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 获取错误信息</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> msg = errorCode[code] || res</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">data</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">msg || errorCode[</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'default'</span><span style="font-family:'Courier';">]</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 二进制数据则直接返回</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';">(res</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">request</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">responseType ===  </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'blob'</span><span style="font-family:'Courier';"> || res</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">request</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">responseType ===  </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'arraybuffer'</span><span style="font-family:'Courier';">){</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">return</span><span style="font-family:'Courier';"> res</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">data</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (code === </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">401</span><span style="font-family:'Courier';">) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (!isRelogin</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">show) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        isRelogin</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">show = true;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        MessageBox</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier'; font-weight:600; color:#204a87;">confirm</span><span style="font-family:'Courier';">(</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'登录状态已过期，您可以继续留在该页面，或者重新登录'</span><span style="font-family:'Courier';">, </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'系统提示'</span><span style="font-family:'Courier';">, {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">          confirmButtonText: </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'重新登录'</span><span style="font-family:'Courier';">,</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">          cancelButtonText: </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'取消'</span><span style="font-family:'Courier';">,</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">          type: </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'warning'</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      ).then(() =&gt; {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        isRelogin</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">show = false;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        store</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">dispatch(</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'LogOut'</span><span style="font-family:'Courier';">).then(() =&gt; {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">          </span><span style="font-family:'Courier'; font-weight:600; color:#204a87;">location</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">href = </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'/index'</span><span style="font-family:'Courier';">;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        })</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      }).</span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">catch</span><span style="font-family:'Courier';">(() =&gt; {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        isRelogin</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">show = false;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      });</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">return</span><span style="font-family:'Courier';"> Promise</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">reject(</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'无效的会话，或者会话已过期，请重新登录。'</span><span style="font-family:'Courier';">)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    } </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">else</span><span style="font-family:'Courier';"> </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (code === </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">500</span><span style="font-family:'Courier';">) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      Message({</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        message: msg,</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        type: </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'error'</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      })</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">return</span><span style="font-family:'Courier';"> Promise</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">reject(</span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">new</span><span style="font-family:'Courier';"> Error(msg))</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    } </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">else</span><span style="font-family:'Courier';"> </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (code !== </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">200</span><span style="font-family:'Courier';">) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      Notification</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">error({</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">        title: msg</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      })</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">return</span><span style="font-family:'Courier';"> Promise</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">reject(</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'error'</span><span style="font-family:'Courier';">)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    } </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">else</span><span style="font-family:'Courier';"> {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">return</span><span style="font-family:'Courier';"> res</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">data</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  },</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  error =&gt; {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    console</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">log(</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'err'</span><span style="font-family:'Courier';"> + error)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    let { message } = error;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (message == </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">&quot;Network Error&quot;</span><span style="font-family:'Courier';">) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      message = </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">&quot;后端接口连接异常&quot;</span><span style="font-family:'Courier';">;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">else</span><span style="font-family:'Courier';"> </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (message</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">includes(</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">&quot;timeout&quot;</span><span style="font-family:'Courier';">)) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      message = </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">&quot;系统接口请求超时&quot;</span><span style="font-family:'Courier';">;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">else</span><span style="font-family:'Courier';"> </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (message</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">includes(</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">&quot;Request failed with status code&quot;</span><span style="font-family:'Courier';">)) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      message = </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">&quot;系统接口&quot;</span><span style="font-family:'Courier';"> + message</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">substr(message</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">length - </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">3</span><span style="font-family:'Courier';">) + </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">&quot;异常&quot;</span><span style="font-family:'Courier';">;</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    Message({</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      message: message,</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      type: </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'error'</span><span style="font-family:'Courier';">,</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      duration: </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">5</span><span style="font-family:'Courier';"> * </span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">1000</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    })</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">return</span><span style="font-family:'Courier';"> Promise</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">reject(error)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">)</span></p>
<p style="-qt-paragraph-type:empty; margin:0px; font-family:'Courier';"><br /></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-style:italic; color:#778899;">// 通用下载方法</span></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">export</span><span style="font-family:'Courier';"> </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">function</span><span style="font-family:'Courier';"> download(url, params, filename) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  downloadLoadingInstance = Loading</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">service({ text: </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">&quot;正在下载数据，请稍候&quot;</span><span style="font-family:'Courier';">, spinner: </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">&quot;el-icon-loading&quot;</span><span style="font-family:'Courier';">, background: </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">&quot;rgba(0, 0, 0, 0.7)&quot;</span><span style="font-family:'Courier';">, })</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">return</span><span style="font-family:'Courier';"> service</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">post(url, params, {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    transformRequest: [(params) =&gt; { </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">return</span><span style="font-family:'Courier';"> tansParams(params) }],</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    headers: { </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'Content-Type'</span><span style="font-family:'Courier';">: </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'application/x-www-form-urlencoded'</span><span style="font-family:'Courier';"> },</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    responseType: </span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'blob'</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  }).then(async (data) =&gt; {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> isLogin = await blobValidate(data);</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">if</span><span style="font-family:'Courier';"> (isLogin) {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> blob = </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">new</span><span style="font-family:'Courier';"> Blob([data])</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      saveAs(blob, filename)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    } </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">else</span><span style="font-family:'Courier';"> {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> resText = await data</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">text();</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> rspObj = JSON</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">parse(resText);</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">const</span><span style="font-family:'Courier';"> errMsg = errorCode[rspObj</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">code] || rspObj</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">msg || errorCode[</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'default'</span><span style="font-family:'Courier';">]</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">      Message</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">error(errMsg);</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    }</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    downloadLoadingInstance</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">close();</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  }).</span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">catch</span><span style="font-family:'Courier';">((r) =&gt; {</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    console</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">error(r)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    Message</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">error(</span><span style="font-family:'Courier'; font-weight:600; color:#2e8b57;">'下载文件出现错误，请联系管理员！'</span><span style="font-family:'Courier';">)</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">    downloadLoadingInstance</span><span style="font-family:'Courier'; font-weight:600; color:#4682b4;">.</span><span style="font-family:'Courier';">close();</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">  })</span></p>
<p style="margin:0px;"><span style="font-family:'Courier';">}</span></p>
<p style="-qt-paragraph-type:empty; margin:0px; font-family:'Courier';"><br /></p>
<p style="margin:0px;"><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">export</span><span style="font-family:'Courier';"> </span><span style="font-family:'Courier'; font-weight:600; color:#8b008b;">default</span><span style="font-family:'Courier';"> service</span></p>
<p style="-qt-paragraph-type:empty; margin:0px; font-family:'Courier';"><br /></p>

<script type="text/javascript" language="javascript" src="jquery.js"></script>
<script type="text/javascript" language="javascript" src="itemlink.js"></script></body>
</html>